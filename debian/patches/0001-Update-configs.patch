From: Takahiro Ono <takahiro.ono@example.com>
Date: Sun, 29 Nov 2020 10:03:38 +0900
Subject: Update configs

---
 client/SAMPLE.fwknoprc              | 21 ++++-----------------
 client/SAMPLE_sdp_ctrl_client.conf  |  8 ++++----
 etc/fwknop/iptables/SAMPLE.rules.v4 | 15 +++++++++++++++
 etc/fwknop/iptables/SAMPLE.rules.v6 | 11 +++++++++++
 server/SAMPLE_sdp_ctrl_client.conf  |  8 ++++----
 server/fwknopd.conf                 |  8 ++++----
 6 files changed, 42 insertions(+), 29 deletions(-)
 create mode 100644 etc/fwknop/iptables/SAMPLE.rules.v4
 create mode 100644 etc/fwknop/iptables/SAMPLE.rules.v6

diff --git a/client/SAMPLE.fwknoprc b/client/SAMPLE.fwknoprc
index 87a8678..b15be17 100644
--- a/client/SAMPLE.fwknoprc
+++ b/client/SAMPLE.fwknoprc
@@ -1,22 +1,9 @@
 [default]
-
-[sdp_ctrl_gate]
-SDP_ID                      333
-ALLOW_IP                    192.168.1.9 
-SERVICE_IDS                 1
-SPA_SERVER                  192.168.1.99
-KEY_BASE64                  bDIge4dZ4X6ssMODIKSgCxjKoxlByPjsw+/FKpWD7Wk=
-HMAC_KEY_BASE64             plY3QcM5tLlwTQOAopHQs3XpEKnE1sbLOfsvHNycNMbJEtYvh7AXV8bNtbdpvDfhV3aAGurP8Er0epPVMw6IHQ==
+SDP_ID                      1
 USE_HMAC                    Y
-
-
-[service_gate]
-SDP_ID                      333
-ALLOW_IP                    192.168.1.9 
-SERVICE_IDS                 2,3,4
-SPA_SERVER                  192.168.1.99
 KEY_BASE64                  bDIge4dZ4X6ssMODIKSgCxjKoxlByPjsw+/FKpWD7Wk=
 HMAC_KEY_BASE64             plY3QcM5tLlwTQOAopHQs3XpEKnE1sbLOfsvHNycNMbJEtYvh7AXV8bNtbdpvDfhV3aAGurP8Er0epPVMw6IHQ==
-USE_HMAC                    Y
-SDP_CTRL_CLIENT_CONF        /path/to/SAMPLE_sdp_ctrl_client.conf
 
+[sdp_ctrl_gate]
+SERVICE_IDS                 1
+SPA_SERVER                  localhost
diff --git a/client/SAMPLE_sdp_ctrl_client.conf b/client/SAMPLE_sdp_ctrl_client.conf
index 5132c62..abe221a 100644
--- a/client/SAMPLE_sdp_ctrl_client.conf
+++ b/client/SAMPLE_sdp_ctrl_client.conf
@@ -12,7 +12,7 @@ CTRL_PORT                       5000
 
 # Address/URL at which the SDP Controller resides
 #
-CTRL_ADDR                       192.168.1.99
+CTRL_ADDR                       localhost
 
 
 
@@ -86,21 +86,21 @@ CTRL_ADDR                       192.168.1.99
 # Location of key file for encrypted communications with the
 # controller
 #
-KEY_FILE                        /path/to/certs/client.key
+KEY_FILE                        ~/.fwknop/certs/client.key
 
 
 
 # Location of certificate file for encrypted communications with
 # the controller
 #
-CERT_FILE                       /path/to/certs/client.crt
+CERT_FILE                       ~/.fwknop/certs/client.crt
 
 
 
 # Location of CA certificate file for verifying peer certificates
 # such as the controller's
 #
-CA_CERT_FILE                    /path/to/certs/ca.crt
+CA_CERT_FILE                    /etc/fwknop/client/ca.crt
 
 
 
diff --git a/etc/fwknop/iptables/SAMPLE.rules.v4 b/etc/fwknop/iptables/SAMPLE.rules.v4
new file mode 100644
index 0000000..3071842
--- /dev/null
+++ b/etc/fwknop/iptables/SAMPLE.rules.v4
@@ -0,0 +1,15 @@
+*filter
+:INPUT DROP [0:0]
+:FORWARD DROP [0:0]
+:OUTPUT ACCEPT [0:0]
+-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
+-A INPUT -p icmp -j ACCEPT
+-A INPUT -i lo -j ACCEPT
+-A FORWARD -m state --state ESTABLISHED,RELATED -j ACCEPT
+COMMIT
+*nat
+:PREROUTING ACCEPT [0:0]
+:INPUT ACCEPT [0:0]
+:POSTROUTING ACCEPT [0:0]
+:OUTPUT ACCEPT [0:0]
+COMMIT
diff --git a/etc/fwknop/iptables/SAMPLE.rules.v6 b/etc/fwknop/iptables/SAMPLE.rules.v6
new file mode 100644
index 0000000..5960b90
--- /dev/null
+++ b/etc/fwknop/iptables/SAMPLE.rules.v6
@@ -0,0 +1,11 @@
+*filter
+:INPUT DROP [0:0]
+:FORWARD DROP [0:0]
+:OUTPUT ACCEPT [0:0]
+COMMIT
+*nat
+:PREROUTING ACCEPT [0:0]
+:INPUT ACCEPT [0:0]
+:POSTROUTING ACCEPT [0:0]
+:OUTPUT ACCEPT [0:0]
+COMMIT
diff --git a/server/SAMPLE_sdp_ctrl_client.conf b/server/SAMPLE_sdp_ctrl_client.conf
index de56d5d..db55ad7 100644
--- a/server/SAMPLE_sdp_ctrl_client.conf
+++ b/server/SAMPLE_sdp_ctrl_client.conf
@@ -12,7 +12,7 @@ CTRL_PORT                       5000
 
 # Address/URL at which the SDP Controller resides
 #
-CTRL_ADDR                       192.168.1.99
+CTRL_ADDR                       localhost
 
 
 
@@ -86,21 +86,21 @@ CTRL_ADDR                       192.168.1.99
 # Location of key file for encrypted communications with the
 # controller
 #
-KEY_FILE                        /path/to/certs/client.key
+KEY_FILE                        /etc/fwknop/certs/gateway.key
 
 
 
 # Location of certificate file for encrypted communications with
 # the controller
 #
-CERT_FILE                       /path/to/certs/client.crt
+CERT_FILE                       /etc/fwknop/certs/gateway.crt
 
 
 
 # Location of CA certificate file for verifying peer certificates
 # such as the controller's
 #
-CA_CERT_FILE                    /path/to/certs/ca.crt
+CA_CERT_FILE                    /etc/fwknop/certs/ca.crt
 
 
 
diff --git a/server/fwknopd.conf b/server/fwknopd.conf
index 402eee8..e1b4c30 100644
--- a/server/fwknopd.conf
+++ b/server/fwknopd.conf
@@ -100,7 +100,7 @@
 # File path to the SDP control client config file. This field
 # must be set when SDP mode and the control client are enabled. 
 #
-#SDP_CTRL_CLIENT_CONF   /path/to/gate_sdp_ctrl_client.conf;
+SDP_CTRL_CLIENT_CONF   /etc/fwknop/gate_sdp_ctrl_client.conf;
 
 
 #
@@ -123,7 +123,7 @@
 # Default if not set is eth0.  The '-i <intf>' command line option overrides
 # the PCAP_INTF setting.
 #
-#PCAP_INTF                   eth0;
+PCAP_INTF                   eth0;
 
 # By default fwknopd does not put the pcap interface into promiscuous mode.
 # Set this to 'Y' to enable promiscuous sniffing.
@@ -414,7 +414,7 @@
 # firewall instead of just to it (i.e. access through the FWKNOP_FORWARD
 # chain instead of the INPUT chain).
 #
-#ENABLE_IPT_FORWARDING       N;
+ENABLE_IPT_FORWARDING       Y;
 
 # Allow SPA clients to request access to a local socket via NAT.  This still
 # puts an ACCEPT rule into the FWKNOP_INPUT chain, but a different port is
@@ -437,7 +437,7 @@
 # SNAT target then also define an IP address with the SNAT_TRANSLATE_IP
 # variable.
 #
-#ENABLE_IPT_SNAT             N;
+ENABLE_IPT_SNAT             Y;
 #SNAT_TRANSLATE_IP           __CHANGEME__;
 
 # Add ACCEPT rules to the FWKNOP_OUTPUT chain. This is usually only useful
